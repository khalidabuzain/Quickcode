<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>EMIS — Combined Exam & Summary Generator</title>
<style>
  :root{
    --bg:#f8fafc; --card:#ffffff; --muted:#6b7280; --accent:#2563eb; --ok:#10b981; --danger:#ef4444;
    --radius:12px; --pad:14px;
  }
  html,body{height:100%;}
  body{
    margin:0;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--bg);
    color:#0f172a;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:20px;
  }

  .container{
    max-width:980px;
    margin:0 auto;
  }

  header{
    text-align:left;
    margin-bottom:12px;
  }
  h1{margin:8px 0; font-size:20px;}
  p.lead{margin:0;color:var(--muted);font-size:13px;}

  /* Tabs */
  .tabs{display:flex;gap:8px;margin:18px 0 12px 0;flex-wrap:wrap;}
  .tabbtn{
    background:#eef2ff;border-radius:10px;padding:8px 12px;border:none;cursor:pointer;font-weight:600;color:#1e293b;
    box-shadow:0 1px 0 rgba(0,0,0,0.03);
  }
  .tabbtn.active{background:var(--accent);color:#fff;}

  .card{
    background:var(--card);border-radius:var(--radius);padding:var(--pad);box-shadow:0 6px 18px rgba(15,23,42,0.06);margin-bottom:14px;
  }

  .section-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;}
  .options-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px;}

  label.checkbox{
    display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;border:1px solid #eef2ff;background:#fbfdff;cursor:pointer;
  }
  input[type=checkbox]{transform:scale(1.1)}
  .small{font-size:13px;color:var(--muted)}

  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px;}
  button.primary{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;}
  button.ghost{background:#f1f5f9;border:1px solid #e6eefc;padding:9px 12px;border-radius:10px;cursor:pointer;}
  button.warn{background:var(--danger);color:white;border:none;padding:9px 12px;border-radius:10px;cursor:pointer;}
  button:disabled{opacity:0.55;cursor:not-allowed}

  textarea#summary{width:100%;min-height:160px;border-radius:10px;padding:12px;border:1px solid #e6eefc;background:#fbfdff;font-family:inherit;resize:vertical;white-space:pre-wrap;color:#0f172a}

  .muted-line{font-size:13px;color:var(--muted);margin-top:6px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[type=text]{padding:8px;border-radius:8px;border:1px solid #e6eefc;background:#fff;min-width:160px}
  .notice{font-size:13px;color:#0b1220;background:#f8fafc;padding:8px;border-radius:8px;border:1px dashed #e6eefc}

  footer{margin-top:10px;color:var(--muted);font-size:13px}
  @media (max-width:520px){ .tabs{gap:6px} }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>EMIS — Combined Exam & Summary Generator</h1>
      <p class="lead">Light, single-file tool — exam findings (ENT/Chest/Abdomen + Skin) and single-select impression templates ready to copy into EMIS.</p>
    </header>

    <div class="tabs" role="tablist" aria-label="Sections">
      <button class="tabbtn active" data-tab="exam">Exam (ENT / Chest / Abdomen)</button>
      <button class="tabbtn" data-tab="skin">Skin Exam</button>
      <button class="tabbtn" data-tab="impression">Impression / Plan</button>
      <button class="tabbtn" data-tab="output">Summary Output</button>
    </div>

    <!-- EXAM -->
    <section id="exam" class="card tabpanel" aria-hidden="false">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <strong>Exam sections</strong>
          <div class="muted-line">Tick findings — use "Show only abnormal" to filter output.</div>
        </div>
        <div class="row">
          <label class="small"><input type="checkbox" id="globalShowAbnormal"> Show only abnormal findings</label>
        </div>
      </div>

      <!-- EARS -->
      <div style="margin-top:12px" class="card" aria-hidden="false">
        <strong>Ear — Right</strong>
        <div class="options-grid" style="margin-top:8px">
          <label class="checkbox"><input type="checkbox" data-what="re" id="rCanalClear"> Canal clear</label>
          <label class="checkbox"><input type="checkbox" data-what="re" id="rErythema"> Erythematous canal</label>
          <label class="checkbox"><input type="checkbox" data-what="re" id="rWax"> Wax / debris / discharge</label>
          <label class="checkbox"><input type="checkbox" data-what="re" id="rTMclear"> Tympanic membrane clear</label>
          <label class="checkbox"><input type="checkbox" data-what="re" id="rTMinflamed"> Tympanic membrane inflamed</label>
          <label class="checkbox"><input type="checkbox" data-what="re" id="rMastoidTender"> Mastoid tenderness</label>
        </div>
      </div>

      <div class="card" style="margin-top:10px">
        <strong>Ear — Left</strong>
        <div class="options-grid" style="margin-top:8px">
          <label class="checkbox"><input type="checkbox" data-what="le" id="lCanalClear"> Canal clear</label>
          <label class="checkbox"><input type="checkbox" data-what="le" id="lErythema"> Erythematous canal</label>
          <label class="checkbox"><input type="checkbox" data-what="le" id="lWax"> Wax / debris / discharge</label>
          <label class="checkbox"><input type="checkbox" data-what="le" id="lTMclear"> Tympanic membrane clear</label>
          <label class="checkbox"><input type="checkbox" data-what="le" id="lTMinflamed"> Tympanic membrane inflamed</label>
          <label class="checkbox"><input type="checkbox" data-what="le" id="lMastoidTender"> Mastoid tenderness</label>
        </div>
      </div>

      <!-- THROAT -->
      <div class="card" style="margin-top:10px">
        <strong>Throat</strong>
        <div class="options-grid" style="margin-top:8px">
          <label class="checkbox"><input type="checkbox" data-what="th" id="throatNormal"> Normal looking throat</label>
          <label class="checkbox"><input type="checkbox" data-what="th" id="throatInflamed"> Inflamed throat</label>
          <label class="checkbox"><input type="checkbox" data-what="th" id="throatExudate"> Covered in exudate</label>
          <label class="checkbox"><input type="checkbox" data-what="th" id="tonsilsNormal"> Tonsils normal</label>
          <label class="checkbox"><input type="checkbox" data-what="th" id="tonsilsLargeRight"> Right tonsil large / inflamed</label>
          <label class="checkbox"><input type="checkbox" data-what="th" id="tonsilsLargeLeft"> Left tonsil large / inflamed</label>
          <label class="checkbox"><input type="checkbox" data-what="th" id="tonsilsExudateRight"> Right tonsil exudate</label>
          <label class="checkbox"><input type="checkbox" data-what="th" id="tonsilsExudateLeft"> Left tonsil exudate</label>
          <label class="checkbox"><input type="checkbox" data-what="th" id="mouthOpen"> Able to open mouth fully</label>
          <label class="checkbox"><input type="checkbox" data-what="th" id="speakFull"> Able to speak in full sentences</label>
          <label class="checkbox"><input type="checkbox" data-what="th" id="noLN"> No cervical lymphadenopathy</label>
        </div>
      </div>

      <!-- CHEST -->
      <div class="card" style="margin-top:10px">
        <strong>Chest</strong>
        <div class="options-grid" style="margin-top:8px">
          <label class="checkbox"><input type="checkbox" data-what="ch" id="noDistress"> Not in respiratory distress</label>
          <label class="checkbox"><input type="checkbox" data-what="ch" id="goodAirEntry"> Good air entry bilaterally</label>
          <label class="checkbox"><input type="checkbox" data-what="ch" id="noAddedSound"> No added sounds</label>
          <label class="checkbox"><input type="checkbox" data-what="ch" id="wheeze"> Wheeze present</label>
          <label class="checkbox"><input type="checkbox" data-what="ch" id="crackles"> Crackles present</label>
          <label class="checkbox"><input type="checkbox" data-what="ch" id="cracklesCough"> Crackles with cough</label>
        </div>
      </div>

      <!-- ABDOMEN -->
      <div class="card" style="margin-top:10px">
        <strong>Abdomen</strong>
        <div class="options-grid" style="margin-top:8px">
          <label class="checkbox"><input type="checkbox" data-what="ab" id="abdSoft"> Soft, non-tender</label>
          <label class="checkbox"><input type="checkbox" data-what="ab" id="abdMild"> Mild tenderness (generalised)</label>
          <label class="checkbox"><input type="checkbox" data-what="ab" id="abdPelvic"> Pelvic tenderness</label>
          <label class="checkbox"><input type="checkbox" data-what="ab" id="abdNoRenal"> No renal angle tenderness</label>
          <label class="checkbox"><input type="checkbox" data-what="ab" id="abdNoGuard"> No guarding</label>
          <label class="checkbox"><input type="checkbox" data-what="ab" id="abdNoRigidity"> No rigidity</label>
        </div>
      </div>

    </section>

    <!-- SKIN -->
    <section id="skin" class="card tabpanel" aria-hidden="true" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Skin examination</strong><div class="muted-line">Tick all that apply and add location / symptoms / severity.</div></div>
      </div>

      <div style="margin-top:12px" class="section-grid">
        <div>
          <div class="options-grid">
            <label class="checkbox"><input type="checkbox" id="normalSkin"> Normal skin</label>
            <label class="checkbox"><input type="checkbox" id="eczema"> Eczema / dry red patches</label>
            <label class="checkbox"><input type="checkbox" id="psoriasis"> Psoriasis / plaques with scale</label>
            <label class="checkbox"><input type="checkbox" id="cellulitis"> Cellulitis / tender red patch</label>
            <label class="checkbox"><input type="checkbox" id="urticaria"> Urticaria / itchy wheals</label>
            <label class="checkbox"><input type="checkbox" id="acne"> Acne / papules & pustules</label>
            <label class="checkbox"><input type="checkbox" id="petechiae"> Petechiae / purpura</label>
          </div>
        </div>

        <div>
          <div style="display:flex;flex-direction:column;gap:8px">
            <div><label class="small">Location (e.g. trunk, limbs): <input type="text" id="skinLocation" placeholder="e.g. trunk, limbs"></label></div>
            <div><label class="small">Symptoms: <input type="text" id="skinSymptoms" placeholder="e.g. pruritus, pain"></label></div>
            <div><label class="small">Severity: <input type="text" id="skinSeverity" placeholder="mild / moderate / severe"></label></div>
            <div class="notice">If "Normal skin" is ticked and any other sign is ticked, the tool will prioritise abnormal descriptors in the summary.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- IMPRESSION / PLAN -->
    <section id="impression" class="card tabpanel" aria-hidden="true" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong>Impression / Plan (tick one)</strong>
          <div class="muted-line">Select one template — it will appear in the final summary. Click again to clear.</div>
        </div>
      </div>

      <div style="margin-top:10px" class="options-grid">
        <label class="checkbox"><input type="radio" name="impression" value="otitisMedia" /> Acute otitis media</label>
        <label class="checkbox"><input type="radio" name="impression" value="otitisExterna" /> Acute otitis externa</label>
        <label class="checkbox"><input type="radio" name="impression" value="tonsillitis" /> Acute tonsillitis</label>
        <label class="checkbox"><input type="radio" name="impression" value="viralPharyngitis" /> Viral pharyngitis</label>
        <label class="checkbox"><input type="radio" name="impression" value="sinusitis" /> Acute sinusitis</label>
        <label class="checkbox"><input type="radio" name="impression" value="none" /> No impression / observational</label>
      </div>

      <div class="muted-line" style="margin-top:10px">Templates provided: Impression → Plan → Safety-net → Red flags.</div>
    </section>

    <!-- OUTPUT -->
    <section id="output" class="card tabpanel" aria-hidden="true" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <strong>Combined Summary</strong>
          <div class="muted-line">Generates a concise summary from all selected sections. Use Copy to EMIS to paste into the record.</div>
        </div>
        <div class="row">
          <button class="primary" id="btnGenerate">Generate Summary</button>
          <button class="ghost" id="btnClear">Clear All</button>
          <button class="ghost" id="btnPrint">Print</button>
          <button class="primary" id="btnCopy">Copy to EMIS</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <textarea id="summary" placeholder="Generated summary will appear here..." readonly></textarea>
        <div class="muted-line" style="margin-top:8px">Tip: place cursor in EMIS comment box and paste (Ctrl+V / Cmd+V) after copying.</div>
      </div>
    </section>

    <footer>
      <div style="margin-top:8px">Single-file — save & upload to GitHub Pages. Light / clinic-friendly UI.</div>
    </footer>

  </div>

<script>
  // --- Tab behaviour
  document.querySelectorAll('.tabbtn').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      document.querySelectorAll('.tabbtn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.getAttribute('data-tab');
      document.querySelectorAll('.tabpanel').forEach(p=>{
        p.style.display = p.id === tab ? 'block' : 'none';
        p.setAttribute('aria-hidden', p.id === tab ? 'false' : 'true');
      });
    });
  });

  // --- Impression templates
  const templates = {
    otitisMedia:
`Impression: Acute otitis media
Plan: Analgesia ± antibiotic as indicated. Review if no improvement in 48-72 hours.
Safety-net: If symptoms worsen, new symptoms develop, or concerns arise seek urgent medical advice or return for immediate review.
Red flags: high fever, severe/worsening ear pain, reduction in responsiveness, persistent vomiting, facial swelling or cellulitis.`,

    otitisExterna:
`Impression: Acute otitis externa
Plan: Topical treatment (as per local guidance), analgesia, keep ear dry.
Safety-net: If symptoms worsen or new symptoms arise seek urgent medical advice or return for review.
Red flags: spreading cellulitis, facial weakness, marked hearing loss, systemic features.`,

    tonsillitis:
`Impression: Acute tonsillitis
Plan: Analgesia, hydration, review in 48 hours; consider antibiotics if bacterial features suspected.
Safety-net: Seek urgent medical attention if symptoms worsen, difficulty breathing or swallowing, drooling, or inability to tolerate fluids.
Red flags: severe dysphagia, muffled voice, stridor, airway compromise.`,

    viralPharyngitis:
`Impression: Viral pharyngitis
Plan: Supportive care — analgesia, hydration, symptomatic treatment. Review if symptoms persist >7 days.
Safety-net: See urgent care if breathing difficulties, drooling, severe pain or dehydration.
Red flags: severe sore throat with drooling, difficulty breathing, muffled voice, high fever.`,

    sinusitis:
`Impression: Acute sinusitis
Plan: Analgesia, nasal saline / decongestant measures, consider delayed antibiotic where appropriate.
Safety-net: If symptoms worsen, new symptoms develop, or concerns arise seek urgent medical advice or return for immediate review.
Red flags: severe facial swelling/pain, periorbital oedema, visual changes, persistent high fever, neurological signs.`
  };

  // --- Utility: gather checked items and format sections
  function getExamFindings(showOnlyAbnormal){
    const mapping = {
      // id -> [label, abnormal?]
      rCanalClear:['canal clear', false],
      rErythema:['erythematous canal', true],
      rWax:['wax / debris / discharge', true],
      rTMclear:['tympanic membrane clear', false],
      rTMinflamed:['tympanic membrane inflamed', true],
      rMastoidTender:['mastoid tenderness', true],

      lCanalClear:['canal clear', false],
      lErythema:['erythematous canal', true],
      lWax:['wax / debris / discharge', true],
      lTMclear:['tympanic membrane clear', false],
      lTMinflamed:['tympanic membrane inflamed', true],
      lMastoidTender:['mastoid tenderness', true],

      throatNormal:['normal looking throat', false],
      throatInflamed:['inflamed throat', true],
      throatExudate:['covered in exudate', true],
      tonsilsNormal:['tonsils normal', false],
      tonsilsLargeRight:['right tonsil large / inflamed', true],
      tonsilsLargeLeft:['left tonsil large / inflamed', true],
      tonsilsExudateRight:['right tonsil exudate', true],
      tonsilsExudateLeft:['left tonsil exudate', true],
      mouthOpen:['able to open mouth fully', false],
      speakFull:['able to speak in full sentences', false],
      noLN:['no cervical lymphadenopathy', false],

      noDistress:['not in respiratory distress', false],
      goodAirEntry:['good air entry bilaterally', false],
      noAddedSound:['no added sounds', false],
      wheeze:['wheeze present', true],
      crackles:['crackles present', true],
      cracklesCough:['crackles with cough', true],

      abdSoft:['soft, non-tender', false],
      abdMild:['mild tenderness (generalised)', true],
      abdPelvic:['pelvic tenderness', true],
      abdNoRenal:['no renal angle tenderness', false],
      abdNoGuard:['no guarding', false],
      abdNoRigidity:['no rigidity', false]
    };

    function build(sideLabel, ids){
      const found = [];
      ids.forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        if(el.checked){
          const [txt,ab] = mapping[id] || [id,false];
          if(showOnlyAbnormal && !ab) return;
          found.push(txt);
        }
      });
      return `${sideLabel}: ${found.length ? found.join(', ') : (showOnlyAbnormal ? '': 'normal findings.')}`;
    }

    const right = build('Right ear', ['rCanalClear','rErythema','rWax','rTMclear','rTMinflamed','rMastoidTender']);
    const left = build('Left ear', ['lCanalClear','lErythema','lWax','lTMclear','lTMinflamed','lMastoidTender']);
    const throat = build('Throat', ['throatNormal','throatInflamed','throatExudate','tonsilsNormal','tonsilsLargeRight','tonsilsLargeLeft','tonsilsExudateRight','tonsilsExudateLeft','mouthOpen','speakFull','noLN']);
    const chest = build('Chest', ['noDistress','goodAirEntry','noAddedSound','wheeze','crackles','cracklesCough']);
    const abdomen = build('Abdomen', ['abdSoft','abdMild','abdPelvic','abdNoRenal','abdNoGuard','abdNoRigidity']);

    return [right,left,throat,chest,abdomen];
  }

  function getSkinFindings(showOnlyAbnormal){
    const items = [
      ['normalSkin','skin appears normal', false],
      ['eczema','erythematous scaly patches consistent with eczema', true],
      ['psoriasis','well-demarcated plaques with scale typical of psoriasis', true],
      ['cellulitis','erythematous tender patch suggestive of cellulitis', true],
      ['urticaria','pruritic wheals consistent with urticaria', true],
      ['acne','inflammatory papules and pustules consistent with acne', true],
      ['petechiae','non-blanching red-purple spots concerning for petechiae', true]
    ];
    const found=[];
    for(const [id,txt,ab] of items){
      const el = document.getElementById(id);
      if(!el) continue;
      if(el.checked){
        if(showOnlyAbnormal && !ab) continue;
        found.push(txt);
      }
    }
    const loc = document.getElementById('skinLocation').value.trim();
    const symp = document.getElementById('skinSymptoms').value.trim();
    const sev = document.getElementById('skinSeverity').value.trim();
    if(found.length===0){
      return ['Skin: normal findings.'];
    } else {
      const first = found[0] + (loc ? ` on ${loc}` : '') + (sev ? ` (${sev})` : '');
      const rest = found.slice(1);
      if(symp) rest.push('Associated symptoms: ' + symp);
      return ['Skin: ' + [first].concat(rest).join('; ')];
    }
  }

  function getImpressionTemplate(){
    const radios = document.querySelectorAll('input[name="impression"]');
    let choice = null;
    radios.forEach(r=>{ if(r.checked) choice = r.value; });
    if(!choice || choice === 'none') return '';
    return templates[choice] || '';
  }

  // --- Generate Summary
  document.getElementById('btnGenerate').addEventListener('click', ()=>{
    const showOnlyAbnormal = document.getElementById('globalShowAbnormal').checked;
    const examLines = getExamFindings(showOnlyAbnormal);
    const skinLines = getSkinFindings(showOnlyAbnormal);
    const impression = getImpressionTemplate();

    // Build final summary
    const parts = [];

    // Include concise headings only if there are abnormal findings or not filtered
    parts.push('== Examination ==');
    examLines.forEach(line=>{
      // If globalShowAbnormal and the line only contains 'normal findings.' then skip
      if(showOnlyAbnormal && line.toLowerCase().includes('normal findings')) return;
      parts.push('• ' + line);
    });

    // Skin
    parts.push('');
    parts.push('== Skin ==');
    skinLines.forEach(line=>{
      if(showOnlyAbnormal && line.toLowerCase().includes('normal findings')) return;
      parts.push('• ' + line);
    });

    // Impression / Plan
    if(impression){
      parts.push('');
      parts.push('== Impression & Plan ==');
      parts.push(impression);
    }

    // If everything filtered out (e.g. showOnlyAbnormal true and nothing abnormal), give a short default
    const summaryText = parts.join('\n');
    const anything = summaryText.replace(/\s+/g,'').length > 0;
    const finalText = (showOnlyAbnormal && summaryText.indexOf('•')===-1)
                    ? 'No abnormal findings selected.'
                    : summaryText;

    document.getElementById('summary').value = finalText;
    // Switch to output tab automatically
    document.querySelectorAll('.tabbtn').forEach(b=>b.classList.remove('active'));
    document.querySelector('[data-tab="output"]').classList.add('active');
    document.querySelectorAll('.tabpanel').forEach(p=>{
      p.style.display = p.id === 'output' ? 'block' : 'none';
      p.setAttribute('aria-hidden', p.id === 'output' ? 'false' : 'true');
    });
  });

  // --- Copy to clipboard (modern + fallback)
  document.getElementById('btnCopy').addEventListener('click', async ()=>{
    const txt = document.getElementById('summary').value;
    if(!txt) { alert('No summary to copy. Generate first.'); return; }
    try{
      if(navigator.clipboard && navigator.clipboard.writeText){
        await navigator.clipboard.writeText(txt);
      } else {
        // fallback for older browsers
        const ta = document.getElementById('summary');
        ta.select();
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
      }
      // small visible feedback
      const orig = document.getElementById('btnCopy').textContent;
      document.getElementById('btnCopy').textContent = 'Copied ✓';
      setTimeout(()=> document.getElementById('btnCopy').textContent = orig, 1600);
    } catch(err){
      alert('Copy failed — please select text and copy manually.');
    }
  });

  // --- Clear all (resets entire form)
  document.getElementById('btnClear').addEventListener('click', ()=>{
    if(!confirm('Clear all fields and selections?')) return;
    document.querySelectorAll('input[type=checkbox]').forEach(cb=>cb.checked=false);
    document.querySelectorAll('input[type=radio]').forEach(rb=>rb.checked=false);
    document.getElementById('skinLocation').value='';
    document.getElementById('skinSymptoms').value='';
    document.getElementById('skinSeverity').value='';
    document.getElementById('summary').value='';
  });

  // --- Print summary
  document.getElementById('btnPrint').addEventListener('click', ()=>{
    const txt = document.getElementById('summary').value;
    if(!txt){ alert('No summary to print. Generate first.'); return; }
    const w = window.open('','_blank');
    w.document.write(`<pre style="font-family:Inter, system-ui, -apple-system, Roboto, Arial;white-space:pre-wrap;line-height:1.4">${escapeHtml(txt)}</pre>`);
    w.document.close();
    w.focus();
    w.print();
  });

  function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  // --- Helpful: allow clicking a checked radio to uncheck it (toggle behavior)
  document.querySelectorAll('input[type=radio][name="impression"]').forEach(radio=>{
    radio.addEventListener('click', function(e){
      if(this._wasChecked){
        this.checked = false;
      }
      // reset stored flag for all then set for this
      document.querySelectorAll('input[type=radio][name="impression"]').forEach(r=>r._wasChecked = r.checked);
    });
  });

  // --- Simple keyboard shortcut: Ctrl+G to generate
  document.addEventListener('keydown', (e)=>{
    if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='g'){
      e.preventDefault(); document.getElementById('btnGenerate').click();
    }
  });

  // --- Accessibility: ensure tab panel initial state
  document.querySelectorAll('.tabpanel').forEach((p,i)=> {
    if(i===0){ p.style.display='block'; p.setAttribute('aria-hidden','false'); } else { p.style.display='none'; p.setAttribute('aria-hidden','true'); }
  });

</script>
</body>
</html>
